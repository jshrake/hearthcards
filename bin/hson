#!/usr/bin/env python3

import argparse
import json
import os
from hearthcards import carddef
from hearthcards.util import hearthstone_data_dir


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument('-r', '--raw', default=False, required=False,
                        action='store_true',
                        help="""Output the raw integer values specified in the
                        Hearthstone data file rather than the human readble
                        string representation""")
    parser.add_argument('-d', '--data-dir', default=hearthstone_data_dir(),
                        required=False,
                        help="""Hearthstone data directory.
                        Only required for a non-default Hearthstone install.
                        Default windows location:
                        C:\\Program Files (x86)\\Hearthstone\\Data\\Win
                        Default osx location:
                        /Applications/Hearthstone/Data/OSX""")
    parser.add_argument('-o', '--output-dir',
                        default=os.path.join(os.getcwd(), "hson-output"),
                        required=False,
                        help="""Output directory. By default, outputs data into
                        the directory_of_this_py_file/output/""")
    args = parser.parse_args()
    if not os.path.exists(args.output_dir):
        os.makedirs(args.output_dir)
    machine_repr = lambda card, lang: card.repr(lang)
    human_repr = lambda card, lang: card.human_repr(lang)
    repr = machine_repr if args.raw else human_repr
    card_defs = carddef.extract_card_defs(args.data_dir)
    for (lang, cards) in card_defs.items():
        data = [repr(card, lang.code) for card in cards]
        filename = os.path.join(args.output_dir, "{0}.json".format(lang.code))
        with open(filename, 'w+', encoding='utf-8') as f:
            f.write(json.dumps(data, sort_keys=True,
                               indent=4, ensure_ascii=False))

if __name__ == "__main__":
    main()
